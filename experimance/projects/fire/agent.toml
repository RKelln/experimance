# Experimance Agent Service Configuration
# This configuration uses the Pipecat backend for local audio processing

service_name = "agent"

# Agent backend selection - use pipecat for local audio processing
agent_backend = "pipecat"

speech_detection_enabled = true

# Conversation cooldown settings
# After a conversation ends (e.g., saying goodbye), wait this long before starting a new one
conversation_cooldown_duration = 12.0  # seconds

# End cooldown early if audience leaves and returns (allows immediate restart on audience change)
# This prevents the same person from immediately restarting, but allows new people to start immediately
cancel_cooldown_on_absence = true

[backend_config]
prompt_path="projects/fire/fire_spirit_prompt.md"

[backend_config.pipecat]
# Pipeline mode: "realtime" for OpenAI Realtime Beta or "ensemble" for separate STT/LLM/TTS
mode = "ensemble"  # Change to "realtime" to use OpenAI Realtime Beta

# LLM settings
openai_model = "gpt-4o"  # For ensemble mode

# OpenAI Realtime settings (realtime mode only)
openai_realtime_model = "gpt-4o-realtime-preview-2025-06-03"
openai_voice = "alloy"  # Options: alloy, echo, fable, onyx, nova, shimmer
turn_detection_threshold = 0.5
turn_detection_silence_ms = 800

# TTS (Text-to-Speech) settings (ensemble mode only)
elevenlabs_voice_id = "EXAVITQu4vr4xnSDxMaL"  # Bella voice
cartesia_voice_id = "bf0a246a-8642-498a-9950-80c35e9276b5"

# Audio settings
audio_in_enabled = true
audio_out_enabled = true
audio_in_sample_rate = 48000
audio_out_sample_rate = 48000       # Standard sample rate compatible with Cartesia

# Audio device selection (comment out to use default devices)
# Use `uv run python scripts/audio_recovery.py list` to list available devices
# Device names support partial matching (e.g., "Yealink" matches "Yealink SP92 Speaker")
# For better performance, you can also specify device indices directly:
audio_input_device_name = "default"   # USB Conference microphone
audio_output_device_name = "default"  # Use pipewire device for Virtual-Multi sink
# Alternatively, use indices for faster startup (uncomment to use):
# audio_input_device_index = 6   # Yealink device index
# audio_output_device_index = 5  # Pipewire device index for Virtual-Multi sink

# Audio error handling
suppress_audio_errors = true         # Suppress ALSA/JACK error messages
audio_device_retry_attempts = 3      # Retry attempts for device initialization
audio_device_retry_delay = 1.0       # Delay between retries (seconds)

# Voice Activity Detection
vad_enabled = true

# Multi-channel audio output (optional)
# Enable this for dual speaker setup with echo cancellation delays
multi_channel_output = false
output_channels = 4                   # Total output channels

# Per-channel delays (in seconds) for echo cancellation
#[backend_config.pipecat.channel_delays]
#0 = 0.120    # Laptop speakers
#1 = 0.120    # Laptop speakers
#2 = 0.000    # Bluetooth speakers
#3 = 0.000    # Bluetooth speakers

# Per-channel volumes (0.0 to 1.0)
#[backend_config.pipecat.channel_volumes]
#0 = 1.0    # Full volume USB
#1 = 1.0    # Full volume USB
#2 = 0.8    # Slightly lower volume for audio port to balance levels
#3 = 0.8    # Slightly lower volume for audio port to balance levels

# Ensemble mode provider settings
[backend_config.pipecat.ensemble]
stt = "assemblyai"  # Speech-to-text provider
llm = "openai"      # Language model provider  
tts = "cartesia"    # Text-to-speech provider

[vision]
audience_detection_enabled = false

# Audience Detection Settings  
audience_detection_interval = 1.5       # Check camera every 1.5 seconds (slightly slower for stability)
conversation_cooldown_duration = 30     # 30s between conversations
cancel_cooldown_on_absence = true       # Cancel cooldown if audience leaves then returns

[reolink]
# Fire project specific Reolink Camera Settings with asymmetric hysteresis and YOLO11 detection
enabled = true
host = "192.168.2.229"                  # Your camera IP
user = "admin"                          # Camera username (can override with REOLINK_USER env var)
# reolink_password - NEVER set here! Use REOLINK_PASSWORD environment variable in .env file
https = true                            # Use HTTPS (recommended)
channel = 0                             # Camera channel (usually 0)
timeout = 2                             # Timeout for checking for people

# Asymmetric hysteresis - different thresholds for detecting vs losing audience
# With YOLO11n detection, we can be much more responsive due to higher reliability
hysteresis_present = 3                  # Quick to detect presence (YOLO11n is reliable)
hysteresis_absent = 8                   # Slower to lose presence (12 seconds at 1.5s intervals)

# Person detection method configuration
detection_method = "yolo11"             # Detection method: "hog", "yolo11", or "hybrid"

# YOLO11 detection settings
yolo_confidence_threshold = 0.6         # Minimum confidence for person detection (0.0-1.0)
yolo_edge_filter_percent = 0.15         # Filter detections near edges (0.0-0.5)
yolo_min_person_width = 40              # Minimum person width in pixels
yolo_min_person_height = 80             # Minimum person height in pixels
yolo_max_detections = 10                # Maximum detections to process per frame
yolo_input_size = 640                   # YOLO input size (320=fast, 640=balanced, 1280=accurate)
yolo_device = "cpu"                     # Device: "cpu", "cuda", "mps"
yolo_model_name = "yolo11n.pt"          # Model: yolo11n.pt (nano), yolo11s.pt (small), etc.
yolo_save_debug_frames = false          # Save annotated frames for debugging
yolo_debug_frame_interval = 10          # Save every Nth frame when debugging

[transcript]
# Transcript management
display_transcripts = false
transcript_max_lines = 3
transcript_line_duration = 10.0
transcript_fade_duration = 1.0

# Speaker names
agent_speaker_name = "Experimance"
human_speaker_name = "Visitor"

# Transcript archival
save_transcripts = true

[osc]
enabled = true
host = "localhost"
port = 5580
address_prefix = "fire/"
presence_address = "presence/"
